<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OLED Studio Pro - Standalone</title>
    <!-- 載入必要框架 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Lucide 圖標庫核心 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- 載入點陣字體 -->
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background-color: #050505; color: #94a3b8; margin: 0; overflow: hidden; }
        /* 捲軸美化 */
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        /* 拉桿樣式 */
        input[type=range]::-webkit-slider-thumb {
            height: 14px; width: 14px; border-radius: 50%; background: #fff; cursor: pointer; -webkit-appearance: none;
            box-shadow: 0 0 10px rgba(0,0,0,0.8); border: 2px solid #3b82f6;
        }
        /* 像素顆粒感遮罩 */
        .oled-pixel-mask {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: 
                linear-gradient(to right, rgba(0,0,0,0.9) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0,0,0,0.9) 1px, transparent 1px);
            pointer-events: none;
            z-index: 100;
        }
    </style>
</head>
<body>
    <nav class="site-nav" aria-label="主目錄">
      <a class="nav-item" href="index.html">
        <div class="nav-title">首頁</div>
        <div class="nav-desc">返回主選單</div>
      </a>
      <a class="nav-item" href="馬達計算.html">
        <div class="nav-title">馬達工程計算</div>
        <div class="nav-desc">馬達工程相關計算工具</div>
      </a>
      <a class="nav-item" href="LED.html">
        <div class="nav-title">LED 應用</div>
        <div class="nav-desc">LED 相關計算與設計</div>
      </a>
      <a class="nav-item" href="OLED版面設計.html">
        <div class="nav-title">OLED 版面設計</div>
        <div class="nav-desc">OLED 介面與版面範例</div>
      </a>
    </nav>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // 優化後的圖標組件，使用 React.createElement 並避免脆弱的解構賦值
        const Icon = ({ name, className = "w-4 h-4", ...props }) => {
            const iconData = useMemo(() => {
                if (!window.lucide || !window.lucide.icons) return null;
                // 處理大小寫匹配
                const key = name.charAt(0).toLowerCase() + name.slice(1);
                return window.lucide.icons[name] || window.lucide.icons[key];
            }, [name]);

            if (!iconData || !Array.isArray(iconData)) return <span className={className} />;

            // Lucide UMD 結構通常是 [tagName, attributes, childrenArray]
            const children = iconData[2] || [];

            return (
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    className={className}
                    {...props}
                >
                    {children.map((child, idx) => {
                        // 使用索引存取避免迭代解構錯誤
                        if (!Array.isArray(child)) return null;
                        const tagName = child[0];
                        const attributes = child[1] || {};
                        return React.createElement(tagName, { key: idx, ...attributes });
                    })}
                </svg>
            );
        };

        const OLED_MODELS = [
            { id: '128x64', name: 'SSD1306 1.3" (128x64)', width: 128, height: 64 },
            { id: '128x32', name: 'SSD1306 0.91" (128x32)', width: 128, height: 32 },
            { id: '64x48', name: 'SSD1306 0.66" (64x48)', width: 64, height: 48 },
            { id: '96x16', name: 'SSD1306 0.86" (96x16)', width: 96, height: 16 },
        ];

        const PRESET_COLORS = [
            { name: '白色', hex: '#FFFFFF', shadow: 'rgba(255, 255, 255, 0.4)' },
            { name: '藍色', hex: '#00F2FF', shadow: 'rgba(0, 242, 255, 0.4)' },
            { name: '黃色', hex: '#FFFC00', shadow: 'rgba(255, 252, 0, 0.4)' },
            { name: '綠色', hex: '#00FF41', shadow: 'rgba(0, 255, 65, 0.4)' },
            { name: '橘色', hex: '#FF8A00', shadow: 'rgba(255, 138, 0, 0.4)' },
        ];

        const OLED_THEMES = [
            { id: 'white', name: '純白模式', hex: '#FFFFFF' },
            { id: 'blue', name: '藍光模式', hex: '#00F2FF' },
            { id: 'yellow', name: '黃金模式', hex: '#FFFC00' },
            { id: 'yellow-blue', name: '黃藍雙色分區', hex: '#FFFC00', split: true },
            { id: 'full-color', name: '全彩自定義', hex: '#FFFFFF', multi: true },
        ];

        const App = () => {
            const [model, setModel] = useState(OLED_MODELS[0]);
            const [theme, setTheme] = useState(OLED_THEMES[3]); 
            const [zoom, setZoom] = useState(4); 
            const [thumbZoom, setThumbZoom] = useState(1); 
            const [items, setItems] = useState([
                { id: '1', type: 'text', content: '25.4', x: 0, y: 0, size: 3, inverted: true, color: null },
                { id: '2', type: 'line', x: 62, y: 0, length: 30, direction: 'V', color: null },
                { id: '3', type: 'text', content: 'ON', x: 66, y: 0, size: 3, inverted: false, color: null },
                { id: '4', type: 'text', content: '85%', x: 97, y: 0, size: 3, inverted: false, color: null }
            ]);
            const [showCode, setShowCode] = useState(false);

            const getTextBounds = (content, size) => ({
                w: content.length * 6 * size,
                h: 8 * size
            });

            const getEffectiveColor = (item) => {
                if (item.color) return item.color;
                if (theme.split) {
                    return item.y < 16 
                        ? PRESET_COLORS.find(c => c.hex === '#FFFC00') 
                        : PRESET_COLORS.find(c => c.hex === '#00F2FF');
                }
                return PRESET_COLORS.find(c => c.hex === theme.hex) || PRESET_COLORS[0];
            };

            const addItem = (type) => {
                const newItem = type === 'text' 
                    ? { id: Date.now().toString(), type: 'text', content: 'TEXT', x: 0, y: 0, size: 1, inverted: false, color: null }
                    : { id: Date.now().toString(), type: 'line', x: 0, y: 0, length: 20, direction: 'H', color: null };
                setItems([...items, newItem]);
            };

            const updateItem = (id, updates) => {
                setItems(items.map(item => item.id === id ? { ...item, ...updates } : item));
            };

            const removeItem = (id) => setItems(items.filter(item => item.id !== id));

            const generateCode = () => {
                let code = `// --- Generated OLED Code ---\n`;
                code += `display.clearDisplay();\n`;
                items.forEach(item => {
                    const colorInfo = getEffectiveColor(item);
                    const colorLabel = item.color ? `0x${colorInfo.hex.replace('#', '')}` : 'SSD1306_WHITE';
                    if (item.type === 'text') {
                        const bounds = getTextBounds(item.content, item.size);
                        if (item.inverted) {
                            code += `display.fillRect(${item.x}, ${item.y}, ${bounds.w}, ${bounds.h}, ${colorLabel});\n`;
                            code += `display.setTextColor(SSD1306_BLACK);\n`;
                        } else {
                            code += `display.setTextColor(${colorLabel});\n`;
                        }
                        code += `display.setTextSize(${item.size});\n`;
                        code += `display.setCursor(${item.x}, ${item.y});\n`;
                        code += `display.print("${item.content}");\n\n`;
                    } else {
                        const cmd = item.direction === 'V' ? 'drawFastVLine' : 'drawFastHLine';
                        code += `display.${cmd}(${item.x}, ${item.y}, ${item.length}, ${colorLabel});\n`;
                    }
                });
                code += `display.display();`;
                return code;
            };

            const RenderOLEDItems = ({ currentZoom }) => (
                <div className="relative w-full h-full" style={{ filter: 'contrast(180%) brightness(1.1)' }}>
                    {items.map(item => {
                        const color = getEffectiveColor(item);
                        if (item.type === 'text') {
                            const bounds = getTextBounds(item.content, item.size);
                            return (
                                <div key={item.id} className="oled-text" style={{
                                    position: 'absolute',
                                    left: item.x * currentZoom,
                                    top: item.y * currentZoom,
                                    height: bounds.h * currentZoom,
                                    width: 'fit-content',
                                    backgroundColor: item.inverted ? color.hex : 'transparent',
                                    color: item.inverted ? '#000' : color.hex,
                                    textShadow: item.inverted ? 'none' : `0 0 ${currentZoom/2}px ${color.shadow}`,
                                    fontSize: (item.size * 8 * currentZoom * 1.1) + 'px', 
                                    fontFamily: "'VT323', monospace",
                                    textTransform: 'uppercase',
                                    lineHeight: 0.85,
                                    display: 'flex',
                                    alignItems: 'flex-start',
                                    justifyContent: 'flex-start',
                                    pointerEvents: 'none',
                                    zIndex: 5,
                                    whiteSpace: 'pre',
                                    letterSpacing: '0.05em',
                                    padding: `0 ${0.2 * currentZoom}px`,
                                    marginTop: `-${0.12 * currentZoom * item.size}px`,
                                    marginLeft: `-${0.02 * currentZoom * item.size}px`,
                                }}>
                                    {item.content}
                                </div>
                            );
                        } else {
                            return (
                                <div key={item.id} style={{
                                    position: 'absolute',
                                    left: item.x * currentZoom,
                                    top: item.y * currentZoom,
                                    width: (item.direction === 'H' ? item.length : 1) * currentZoom,
                                    height: (item.direction === 'V' ? item.length : 1) * currentZoom,
                                    backgroundColor: color.hex,
                                    boxShadow: `0 0 ${currentZoom}px ${color.shadow}`,
                                    pointerEvents: 'none',
                                    zIndex: 3
                                }} />
                            );
                        }
                    })}
                </div>
            );

            return (
                <div className="flex flex-col h-screen bg-[#050505] text-slate-400 font-sans selection:bg-blue-500/30 overflow-hidden text-xs md:text-sm">
                    <header className="flex items-center justify-between px-6 py-4 bg-[#0a0a0a] border-b border-white/5 shadow-2xl z-50">
                        <div className="flex items-center gap-4">
                            <div className="bg-blue-600 p-2 rounded-xl"><Icon name="Layout" className="w-5 h-5 text-white" /></div>
                            <div className="hidden sm:block"><h1 className="text-sm font-black tracking-widest uppercase text-white">OLED Studio Pro</h1></div>
                        </div>
                        <div className="flex items-center gap-6 bg-white/5 px-6 py-2 rounded-full border border-white/5">
                            <div className="flex items-center gap-3 w-48 md:w-56">
                                <Icon name="Minimize2" className="w-3 h-3 text-slate-600" />
                                <input type="range" min="1" max="6" step="0.1" value={zoom} onChange={(e) => setZoom(parseFloat(e.target.value))} className="flex-1 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-blue-500" />
                                <Icon name="Maximize2" className="w-3 h-3 text-slate-600" />
                            </div>
                            <span className="text-[11px] font-mono text-blue-500 font-black w-10 md:w-14 text-center">{zoom.toFixed(1)}x</span>
                        </div>
                        <button onClick={() => setShowCode(!showCode)} className="flex items-center gap-2 px-6 py-2.5 bg-[#151515] hover:bg-blue-600 text-white rounded-xl transition-all font-black text-[11px] uppercase border border-white/10 shadow-lg active:scale-95">
                            <Icon name="Code" className="w-4 h-4 text-blue-400" />
                            <span className="hidden sm:inline">{showCode ? "佈局編輯" : "導出代碼"}</span>
                        </button>
                    </header>

                    <main className="flex flex-1 overflow-hidden relative">
                        <div className="flex-1 flex flex-col items-center justify-center p-8 overflow-auto bg-[#040404] relative text-center">
                            <div className="inline-block relative">
                                <div className="p-1.5 bg-[#1a1a1a] rounded-sm border border-white/10 shadow-[0_0_80px_rgba(0,0,0,1)]">
                                    <div className="relative bg-black overflow-hidden" style={{ width: model.width * zoom, height: model.height * zoom }}>
                                        <RenderOLEDItems currentZoom={zoom} />
                                        <div className="oled-pixel-mask" style={{ backgroundSize: `${zoom}px ${zoom}px`, display: zoom > 2 ? 'block' : 'none' }} />
                                    </div>
                                </div>
                                <div className="absolute -top-6 left-0 w-full flex justify-between text-[9px] font-mono text-slate-700 pointer-events-none tracking-widest px-1"><span>0px</span><span>{model.width}px</span></div>
                            </div>

                            <div className="absolute bottom-6 right-6 flex flex-col items-end gap-3 z-50">
                                <div className="bg-[#0a0a0a]/90 backdrop-blur-xl border border-white/10 p-4 rounded-2xl shadow-3xl ring-1 ring-white/5">
                                    <div className="flex items-center justify-between mb-3 px-1"><span className="text-[10px] font-black text-slate-400 uppercase tracking-widest">實體預覽</span><span className="text-[9px] font-mono text-blue-500 font-bold">{thumbZoom.toFixed(2)}x</span></div>
                                    <div className="bg-black relative border border-white/20 overflow-hidden mb-3" style={{ width: model.width * thumbZoom, height: model.height * thumbZoom }}>
                                        <RenderOLEDItems currentZoom={thumbZoom} />
                                        <div className="oled-pixel-mask opacity-20" style={{ backgroundSize: `${thumbZoom}px ${thumbZoom}px` }} />
                                    </div>
                                    <div className="flex items-center gap-2 px-1"><Icon name="Search" className="w-3 h-3 text-slate-600" /><input type="range" min="0.5" max="1" step="0.05" value={thumbZoom} onChange={(e) => setThumbZoom(parseFloat(e.target.value))} className="w-24 h-1 bg-slate-800 rounded-lg appearance-none cursor-pointer accent-blue-600" /></div>
                                </div>
                            </div>

                            {showCode && (
                                <div className="absolute bottom-20 left-1/2 -translate-x-1/2 w-[90%] max-w-xl bg-[#0a0a0a]/95 backdrop-blur-xl border border-white/10 rounded-2xl p-6 shadow-3xl animate-in fade-in zoom-in-95">
                                    <div className="flex justify-between items-center mb-5 pb-3 border-b border-white/5"><span className="text-[10px] font-black text-blue-400 uppercase tracking-widest">C++ Arduino Generator</span><button onClick={() => {
                                        const el = document.createElement('textarea'); el.value = generateCode(); document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
                                    }} className="text-[9px] bg-blue-600 text-white px-4 py-1.5 rounded-lg hover:bg-blue-500 transition-all font-black uppercase">Copy</button></div>
                                    <pre className="text-[11px] text-emerald-400 font-mono overflow-auto max-h-56 custom-scrollbar whitespace-pre-wrap leading-relaxed opacity-80">{generateCode()}</pre>
                                </div>
                            )}
                        </div>

                        <div className="w-80 md:w-[380px] bg-[#0a0a0a] border-l border-white/5 flex flex-col z-50 shadow-2xl custom-scrollbar overflow-y-auto">
                            <div className="p-4 md:p-6 space-y-6 border-b border-white/5 bg-[#0d0d0d]">
                                <div className="space-y-4">
                                    <label className="text-[10px] font-black text-slate-600 uppercase tracking-widest flex items-center gap-2"><Icon name="Monitor" className="w-3 h-3" /> 全域顯示設定</label>
                                    <div className="grid grid-cols-2 gap-3">
                                        <select className="w-full bg-black border border-white/10 rounded-xl p-2.5 text-[11px] font-black outline-none focus:border-blue-600 text-white appearance-none" value={model.id} onChange={(e) => setModel(OLED_MODELS.find(m => m.id === e.target.value))}>
                                            {OLED_MODELS.map(m => <option key={m.id} value={m.id}>{m.name}</option>)}
                                        </select>
                                        <select className="w-full bg-black border border-white/10 rounded-xl p-2.5 text-[11px] font-black outline-none focus:border-blue-600 text-white appearance-none" value={theme.id} onChange={(e) => setTheme(OLED_THEMES.find(c => c.id === e.target.value))}>
                                            {OLED_THEMES.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                        </select>
                                    </div>
                                </div>
                                <div className="flex gap-3">
                                    <button onClick={() => addItem('text')} className="flex-1 flex items-center justify-center gap-2 bg-[#1a1a1a] hover:bg-blue-600/10 py-3 rounded-xl text-[10px] font-black border border-white/5 hover:border-blue-500 transition-all active:scale-95 text-slate-400 group"><Icon name="Type" className="w-4 h-4 text-blue-500 group-hover:scale-110 transition-transform" /> 文字</button>
                                    <button onClick={() => addItem('line')} className="flex-1 flex items-center justify-center gap-2 bg-[#1a1a1a] hover:bg-emerald-600/10 py-3 rounded-xl text-[10px] font-black border border-white/5 hover:border-emerald-500 transition-all active:scale-95 text-slate-400 group"><Icon name="Minus" className="w-4 h-4 text-emerald-500 rotate-90 group-hover:scale-110 transition-transform" /> 線條</button>
                                </div>
                            </div>

                            <div className="p-4 md:p-6 space-y-6 bg-black/40">
                                {items.map((item, index) => (
                                    <div key={item.id} className="bg-[#121212] border border-white/5 rounded-2xl overflow-hidden hover:border-white/10 transition-all shadow-xl shadow-black/50">
                                        <div className="flex items-center justify-between p-3 md:p-4 bg-white/5 border-b border-white/5">
                                            <div className="flex items-center gap-3"><span className="w-6 h-6 flex items-center justify-center bg-blue-600 text-white text-[10px] font-black rounded-lg">{index + 1}</span><span className="text-[10px] font-black uppercase text-slate-500 tracking-widest">{item.type === 'text' ? 'TEXT' : 'LINE'}</span></div>
                                            <button onClick={() => removeItem(item.id)} className="text-slate-700 hover:text-red-500 transition-all p-2 rounded-lg hover:bg-red-500/10"><Icon name="Trash2" className="w-4 h-4" /></button>
                                        </div>
                                        <div className="p-4 md:p-5 space-y-5">
                                            <div className="space-y-4">
                                                <div className="space-y-2">
                                                    <label className="text-[9px] font-black text-slate-700 uppercase flex items-center gap-2"><Icon name="Palette" className="w-3 h-3" /> 個別顏色</label>
                                                    <div className="flex gap-2 items-center">
                                                        <button onClick={() => updateItem(item.id, { color: null })} className={`w-6 h-6 rounded-md border text-[9px] font-bold ${!item.color ? 'border-blue-500 bg-blue-500/20 text-white' : 'border-white/5 bg-black text-slate-500'}`}>Auto</button>
                                                        <div className="flex gap-1.5 flex-wrap">{PRESET_COLORS.map(c => <button key={c.hex} onClick={() => updateItem(item.id, { color: c })} style={{ backgroundColor: c.hex }} className={`w-5 h-5 rounded-full border-2 transition-all ${item.color?.hex === c.hex ? 'border-white scale-125' : 'border-transparent opacity-60 hover:opacity-100'}`} />)}</div>
                                                    </div>
                                                </div>
                                                {item.type === 'text' ? (
                                                    <div className="space-y-4">
                                                        <div className="space-y-1"><label className="text-[9px] font-black text-slate-700 uppercase">內容</label><input type="text" value={item.content} onChange={(e) => updateItem(item.id, { content: e.target.value })} className="w-full bg-black border border-white/10 rounded-xl p-2.5 text-xs font-bold text-white outline-none focus:border-blue-600 transition-all" /></div>
                                                        <div className="grid grid-cols-2 gap-4">
                                                            <div className="space-y-1"><label className="text-[9px] font-black text-slate-700 uppercase">大小</label><input type="number" min="1" max="4" value={item.size} onChange={(e) => updateItem(item.id, { size: Math.max(1, parseInt(e.target.value) || 1) })} className="w-full bg-black border border-white/10 rounded-xl p-2.5 text-xs font-bold text-white outline-none" /></div>
                                                            <div className="flex items-center gap-2 mt-5">
                                                                <input type="checkbox" id={`inv-${item.id}`} checked={item.inverted} onChange={(e) => updateItem(item.id, { inverted: e.target.checked })} className="w-4 h-4 accent-blue-600" />
                                                                <label htmlFor={`inv-${item.id}`} className="text-[10px] font-black uppercase text-slate-500">反白</label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div className="grid grid-cols-2 gap-4">
                                                        <div className="space-y-1"><label className="text-[9px] font-black text-slate-700 uppercase">方向</label><select className="w-full bg-black border border-white/10 rounded-xl p-2.5 text-[10px] font-black text-white outline-none" value={item.direction} onChange={(e) => updateItem(item.id, { direction: e.target.value })}><option value="H">水平</option><option value="V">垂直</option></select></div>
                                                        <div className="space-y-1"><label className="text-[9px] font-black text-slate-700 uppercase">長度</label><input type="number" value={item.length} onChange={(e) => updateItem(item.id, { length: parseInt(e.target.value) || 1 })} className="w-full bg-black border border-white/10 rounded-xl p-2.5 text-xs font-bold text-white outline-none" /></div>
                                                    </div>
                                                )}
                                                <div className="pt-4 border-t border-white/5 space-y-4">
                                                    <div className="flex justify-between text-[9px] font-black text-slate-700 uppercase font-mono"><span>X: {item.x}px</span><span>Y: {item.y}px</span></div>
                                                    <div className="space-y-4"><input type="range" min="0" max={model.width} value={item.x} onChange={(e) => updateItem(item.id, { x: parseInt(e.target.value) })} className="w-full h-1 bg-black rounded-lg appearance-none cursor-pointer accent-blue-500" /><input type="range" min="0" max={model.height} value={item.y} onChange={(e) => updateItem(item.id, { y: parseInt(e.target.value) })} className="w-full h-1 bg-black rounded-lg appearance-none cursor-pointer accent-emerald-500" /></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>