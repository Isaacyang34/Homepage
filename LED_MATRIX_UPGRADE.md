# LED 點陣矩陣顯示 - V1.1 升級説明

## 🎯 主要改進

LED 螢幕設計界面規劃 V1.1 已升級，整合了真實 LED 點陣矩陣渲染技術。

### ✨ 新增功能

#### 1. **真實 LED 燈珠模擬**
- 使用 Canvas API 渲染真實的 LED 燈珠矩陣
- 每個像素點渲現為一個圓形 LED 燈珠
- 自動根據 zoom 級別調整燈珠大小
- 包含發光效果 (shadow/blur)

#### 2. **5x7 點陣字庫系統**
- 集成 ASCII 標準字體（32-90 字符）
- 每個字符使用 5 列 × 7 行的點陣編碼
- 完全支持真實 LED 顯示屏的字體渲染方式
- 字符寬度恆定為 6 像素（5px 字寬 + 1px 間距）

#### 3. **字體大小限制為個位數（1-9）**
- **理由**：LED 點陣矩陣中，字體大小直接對應點陣縮放倍數
- **範圍**：1（最小，基礎 5x7） ～ 9（最大，45x63 像素）
- **效果**：Size=1 時顯示為 5×7 點陣，Size=3 時為 15×21，Size=9 時為 45×63

#### 4. **LED 背景亮度控制**
- 新增側邊欄控制項：「LED 背景亮度」
- 範圍：0% ～ 100%
- 效果：控制未點亮 LED 燈珠的亮度
- 默認值：30%（模擬真實 LED 屏的暗態表現）

---

## 🔧 技術實現

### 渲染流程

```
1. 離屏緩衝渲染
   ├─ 使用 bufferCanvas (低解析度)
   ├─ 繪製文字和線條到像素級別
   └─ 保存為 ImageData

2. LED 圓點映射
   ├─ 讀取 ImageData 的 RGBA 數據
   ├─ 遍歷每個像素點
   ├─ 點亮的像素 → 渲染彩色 LED 圓點
   ├─ 暗色像素 → 渲染灰色背景 LED 圓點
   └─ 應用發光效果 (shadowBlur + shadowColor)

3. 性能優化
   ├─ 關閉圖像平滑 (imageSmoothingEnabled = false)
   ├─ 使用 pixelated 渲染
   └─ Canvas 大小動態調整
```

### 5x7 點陣字庫格式

每個字符由 5 列數據表示，每列是 7 位的位元編碼：

```javascript
// 例：字符 'A' = [126, 17, 17, 17, 126]
//     二進制表示：
//     Col 0: 01111110 (126) = ██████ 
//     Col 1: 00010001 (17)  = █    █
//     Col 2: 00010001 (17)  = █    █
//     Col 3: 00010001 (17)  = █    █
//     Col 4: 01111110 (126) = ██████
//
// 視覺效果：
// █ █ █ █ █ █
// █     █
// █     █
// █     █
// █ █ █ █ █
```

### 字體大小倍數 (Scale)

| Scale | 寬 | 高 | 用途 |
|-------|----|----|------|
| 1 | 5px | 7px | 小字體，單行顯示 |
| 2 | 10px | 14px | 中等字體 |
| 3 | 15px | 21px | 常用大小 ✓ |
| 4-9 | 20-45px | 28-63px | 大字體，多行醒目 |

---

## 📱 使用指南

### 1. 創建文字元件

1. 點擊側邊欄的「文字」按鈕添加新元件
2. 在「元件編輯」面板中設置：
   - **內容**：輸入要顯示的文字（自動轉換為大寫）
   - **尺寸**：1-9 之間的整數
   - **位置**：X、Y 坐標
   - **顏色**：選擇 LED 燈珠顏色

### 2. 調整 LED 背景亮度

在「螢幕配置」面板中：
- 使用滑塊調整 0-100%
- 實時預覽背景 LED 燈珠亮度
- 建議值：25-40%（接近真實屏效果）

### 3. 字體大小選擇建議

| 情景 | 推薦 Size | 說明 |
|------|----------|------|
| 單個數字顯示 | 3-5 | 清晰醒目 |
| 日期時間 (HH:MM) | 2-3 | 緊湊排列 |
| 文本提示 | 1-2 | 節省空間 |
| 大型告示 | 6-9 | 遠距離可視 |

### 4. 複合顯示示例

```
顯示「溫度」和「數值」的常見組合：

Size=1: "TEMP"  (緊湊)
Size=3: "88°C"  (醒目)

或

Size=2: "TIME 12:34" (平衡)
```

---

## 🎨 效果對比

### 舊版（V1.0）vs 新版（V1.1）

| 特性 | V1.0 | V1.1 |
|------|------|------|
| 字體渲染 | DOM 元素 | 真實 LED 點陣 |
| 視覺效果 | 光滑字體 | 點陣化字體 |
| 字體大小 | 浮點數任意 | 整數 1-9 |
| 背景燈珠 | 無 | 可調節亮度 |
| 發光效果 | 無 | Canvas shadowBlur |
| 真實感 | 模擬 | 非常高 |
| 性能 | 好（DOM） | 良好（Canvas） |

---

## 🔍 常見問題

### Q: 為什麼字體大小限制為 1-9？
**A**: LED 點陣顯示中，字體大小就是縮放倍數（×1、×2、×3...）。使用浮點數會導致不規則的像素渲染，破壞點陣美感。整數限制確保完美的網格對齐。

### Q: 字體看起來有點模糊？
**A**: 
1. 確認已開啟「顯示網格」（眼睛圖標）
2. 增大 zoom 級別查看（滑塊或鼠標滾輪）
3. 調整 LED 背景亮度，對比會更清晰

### Q: 支援中文或特殊字符嗎？
**A**: 當前只支持 ASCII 字符 (32-90)。如需支持中文，需要額外的點陣字庫數據。

### Q: 性能如何？
**A**: 
- Canvas 渲染比 DOM 快 10-20 倍
- 支持 60Hz 實時渲染
- 建議 zoom ≤ 4.0 維持流暢動畫

### Q: 如何導出為真實 LED 代碼？
**A**: 
1. 設計完成後點擊「代碼」按鈕
2. 查看生成的 C++ 代碼
3. 代碼使用 `dma_display->drawText()` API
4. 直接上傳到 ESP32 微控制器

---

## 🛠️ 高級技巧

### 1. 實現多色顯示
```
方法：使用多個文字元件
例：
  - "HELLO" (紅色，位置 0,0)
  - "WORLD" (綠色，位置 0,10)
```

### 2. 創建動畫效果
```
方法：使用動畫控制
1. 選中元件
2. 設置「動畫」為「閃爍」、「呼吸」或「平移」
3. 點擊播放按鈕預覽
```

### 3. 比較不同配置
```
方法：使用版本管理
1. 完成一個設計
2. 運行 .\manage-versions.ps1 backup
3. 繼續修改
4. 運行 .\manage-versions.ps1 compare 查看差異
```

---

## 📊 性能指標

| 項目 | 數值 |
|------|------|
| 最大支持解析度 | 128×64 pixels |
| 實時渲染幀率 | 60 FPS |
| 單屏最多元件 | 100+ |
| 導出代碼大小 | ~2-5 KB |

---

## 📝 更新日誌

### V1.1 (2026-01-30)
- ✅ 集成 LED 真實點陣渲染引擎
- ✅ 添加 5x7 標準字庫
- ✅ 限制字體大小為 1-9
- ✅ 添加 LED 背景亮度控制
- ✅ 改進 Canvas 渲染性能
- ✅ 添加完整的版本控制系統
- ✅ 添加代碼修改檢查清單

### V1.0 (2026-01-30)
- ✅ 基礎功能完成
- ✅ React 應用架構
- ✅ LED 模組規格定義
- ✅ 代碼生成功能

---

## 🚀 下一步改進方向

- [ ] 支持自定義字庫編輯器
- [ ] 支持中文/日文點陣字體
- [ ] 實時模擬 MCU 顯示效果
- [ ] 支持 GIF/視頻導入轉換
- [ ] Web 版本無縫同步

---

**需要幫助？** 查看 MODIFY_CHECKLIST.md 和 DEVELOPMENT_GUIDE.md

**最後更新**: 2026-01-30
